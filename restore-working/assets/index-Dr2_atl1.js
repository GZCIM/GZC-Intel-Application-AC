import{j as o,m as T}from"./ui-vendor-k0rDQjvt.js";import{R as N,r as x}from"./react-vendor-C_4inHyB.js";import{u as O,a as Z}from"./index-DG8D6RJe.js";const U="https://portfolio-backend.agreeablepond-1a74a92d.eastus.azurecontainerapps.io";let w=null;const V=l=>{w=l};async function H(){if(w)try{const l=await w();return console.log("GZC Portfolio: Got MSAL token:",l?`${l.substring(0,20)}...`:"null"),l}catch(l){return console.error("Failed to get access token:",l),null}return console.error("No authentication token provider configured for GZC Portfolio"),null}async function F(l,r={}){const n=await H(),i=`${U}${l}`,t={"Content-Type":"application/json",...r.headers};n?(t.Authorization=`Bearer ${n}`,console.log(`Making authenticated API call to: ${i}`),console.log(`üîë Portfolio Token: ${n.substring(0,30)}...`),console.log(`üîë Portfolio Token Length: ${n.length}`),console.log(`üîë Portfolio Authorization Header: Bearer ${n.substring(0,30)}...`)):(console.warn("No access token found for API call"),console.log(`Making unauthenticated API call to: ${i}`));const s=await fetch(i,{...r,headers:t});if(console.log(`API Response: ${s.status} ${s.statusText}`),!s.ok){const c=await s.text();throw console.error(`API Error Response: ${c}`),new Error(`API call failed: ${s.status} ${s.statusText} - ${c}`)}const a=await s.json();return console.log("API Response Data:",a),a}function R(l){return l.map((r,n)=>({id:r.id||`TRD${n.toString().padStart(6,"0")}`,trade_date:r.trade_date||r.tradeDate||new Date().toISOString().split("T")[0],value_date:r.value_date||r.valueDate||new Date().toISOString().split("T")[0],currency_pair:r.currency_pair||r.currencyPair||"EUR/USD",notional:parseFloat(r.notional||r.amount||0),rate:parseFloat(r.rate||r.execution_rate||1),market_rate:parseFloat(r.market_rate||r.current_rate||r.rate||1),pnl:parseFloat(r.pnl||r.unrealized_pnl||0),counterparty:r.counterparty||r.broker||"Unknown",status:r.status||"ACTIVE",trader:r.trader||r.user||"Unknown",fund_id:r.fund_id||r.fundId||"6"}))}function X(l){const r=new Map;return l.forEach(n=>{const i=r.get(n.currency_pair);i?(i.net_position+=n.notional,i.trade_count+=1,i.total_volume+=Math.abs(n.notional),i.weighted_avg_rate=(i.weighted_avg_rate*(i.trade_count-1)+n.rate)/i.trade_count,n.trade_date>i.last_trade_date&&(i.last_trade_date=n.trade_date)):r.set(n.currency_pair,{currency_pair:n.currency_pair,net_position:n.notional,trade_count:1,weighted_avg_rate:n.rate,total_volume:Math.abs(n.notional),last_trade_date:n.trade_date,position_status:n.notional>0?"LONG":n.notional<0?"SHORT":"FLAT"})}),Array.from(r.values()).forEach(n=>{n.position_status=n.net_position>0?"LONG":n.net_position<0?"SHORT":"FLAT"}),Array.from(r.values())}class q{lastFetchedData=[];updateSubscribers=[];async fetchTrades(r,n){try{console.log("Fetching portfolio data from backend...");const i=await F("/portfolio/");if(i.status!=="success")throw new Error("Backend returned error status");let t=R(i.data||[]);if(this.lastFetchedData=t,r&&r!=="all"&&(t=t.filter(a=>a.fund_id===r)),n){const a=n==="active";t=t.filter(c=>a?c.status==="ACTIVE":c.status==="CLOSED")}const s={total_trades:t.length,total_notional:t.reduce((a,c)=>a+c.notional,0),total_pnl:t.reduce((a,c)=>a+c.pnl,0),profitable_trades:t.filter(a=>a.pnl>0).length,losing_trades:t.filter(a=>a.pnl<0).length};return console.log(`Fetched ${t.length} trades from backend`),{trades:t,summary:s}}catch(i){return console.error("Error fetching trades from backend:",i),{trades:[],summary:{total_trades:0,total_notional:0,total_pnl:0,profitable_trades:0,losing_trades:0}}}}async fetchPositions(r,n){try{const{trades:i}=await this.fetchTrades(r,n),t=X(i),s={total_positions:t.length,long_positions:t.filter(a=>a.position_status==="LONG").length,short_positions:t.filter(a=>a.position_status==="SHORT").length,total_volume:t.reduce((a,c)=>a+c.total_volume,0),unique_pairs:t.length};return console.log(`Generated ${t.length} positions from trades`),{positions:t,summary:s}}catch(i){return console.error("Error fetching positions:",i),{positions:[],summary:{total_positions:0,long_positions:0,short_positions:0,total_volume:0,unique_pairs:0}}}}async subscribeToUpdates(r){this.updateSubscribers.push(r);const n=setInterval(async()=>{try{const i=await F("/portfolio/");if(i.status==="success"){const t=R(i.data||[]);t.forEach(s=>{const a=this.lastFetchedData.find(c=>c.id===s.id);(!a||a.market_rate!==s.market_rate||a.pnl!==s.pnl)&&r(s)}),this.lastFetchedData=t}}catch(i){console.warn("Error in real-time update:",i)}},1e4);return()=>{clearInterval(n);const i=this.updateSubscribers.indexOf(r);i>-1&&this.updateSubscribers.splice(i,1)}}}const z=new q,J={surface:"#1a1a1a",border:"#333333",text:"#ffffff",textSecondary:"#cccccc",background:"#0d1117",primary:"#7A9E65",success:"#28a745",danger:"#dc3545",warning:"#ffc107",info:"#17a2b8"};class K extends N.Component{constructor(r){super(r),this.state={hasError:!1}}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,n){console.warn("ThemeContext error caught by boundary:",r,n)}render(){return this.state.hasError?o.jsx(E,{...this.props.componentProps,theme:this.props.fallbackTheme}):this.props.children}}const Y=l=>o.jsx(K,{fallbackTheme:J,componentProps:l,children:o.jsx(m,{...l})}),m=l=>{const{currentTheme:r}=O();return o.jsx(E,{...l,theme:r})},E=({width:l="100%",height:r="100%",defaultView:n="trades",defaultFund:i="6",theme:t})=>{const[s,a]=x.useState(n),[c,I]=x.useState([]),[f,G]=x.useState(null),[A,D]=x.useState([]),[S,L]=x.useState(null),[d,_]=x.useState(!1),[h,v]=x.useState(null),[p,M]=x.useState(i),[u,W]=x.useState(!0),{isAuthenticated:b,getAccessToken:B}=Z();x.useEffect(()=>{console.log("üîí GZC Portfolio Auth Setup:",{isAuthenticated:b}),b&&(console.log("‚úÖ Setting up GZC Portfolio auth provider"),V(B))},[b]);const P=x.useCallback(async()=>{try{_(!0),v(null),console.log("Making authenticated portfolio API call for trades...");const e=u?"active":"inactive",{trades:g,summary:j}=await z.fetchTrades(p==="all"?void 0:p,e);I(g),G(j)}catch(e){console.error("Error fetching trades:",e),v("Failed to fetch trades")}finally{_(!1)}},[p,u]),$=x.useCallback(async()=>{try{_(!0),v(null),console.log("Making authenticated portfolio API call for positions...");const e=u?"active":"inactive",{positions:g,summary:j}=await z.fetchPositions(p==="all"?void 0:p,e);D(g),L(j)}catch(e){console.error("Error fetching positions:",e),v("Failed to fetch positions")}finally{_(!1)}},[p,u]);x.useEffect(()=>{if(console.log("üîÑ GZC Portfolio useEffect triggered:",{viewMode:s,selectedFund:p,isActive:u,isAuthenticated:b}),!b){console.log("‚ùå Skipping data fetch - user not authenticated");return}s==="trades"?(console.log("üìä Fetching trades..."),P()):(console.log("üìä Fetching positions..."),$())},[s,p,u,b,P,$]);const y=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),C=(e,g)=>{if(!e)return"-";const j=g?.includes("JPY")?2:4;return e.toFixed(j)},k=e=>{switch(e){case"ACTIVE":return t.success;case"LONG":return t.success;case"SHORT":return t.danger;case"FLAT":return t.textSecondary;default:return t.textSecondary}};return o.jsxs("div",{style:{width:l,height:r,background:t.surface,borderRadius:"8px",border:`1px solid ${t.border}`,display:"flex",flexDirection:"column",overflow:"hidden"},children:[o.jsx("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${t.border}`,backgroundColor:t.surface},children:o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsxs("div",{children:[o.jsxs("h2",{style:{color:t.text,fontSize:"16px",fontWeight:"600",margin:0},children:["GZC Portfolio -"," ",s==="trades"?"FX Forward Trades":"FX Positions"]}),o.jsx("div",{style:{color:t.textSecondary,fontSize:"11px",marginTop:"4px"},children:s==="trades"?`${c.length} trades ‚Ä¢ ${u?"Active":"Closed"} ‚Ä¢ ${p==="all"?"All Funds":p==="6"?"GCF":"GMF"}`:`${A.length} positions ‚Ä¢ ${u?"Active":"Closed"} ‚Ä¢ ${p==="all"?"All Funds":p==="6"?"GCF":"GMF"}`})]}),o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[o.jsxs("div",{style:{display:"flex",background:t.background,borderRadius:"4px",padding:"2px",border:`1px solid ${t.border}`},children:[o.jsx("button",{onClick:()=>a("trades"),disabled:d,style:{background:s==="trades"?t.primary:"transparent",color:s==="trades"?"white":t.text,border:"none",borderRadius:"3px",padding:"4px 10px",fontSize:"11px",cursor:d?"not-allowed":"pointer",transition:"all 0.2s",opacity:d?.7:1},children:"Trades"}),o.jsx("button",{onClick:()=>a("positions"),disabled:d,style:{background:s==="positions"?t.primary:"transparent",color:s==="positions"?"white":t.text,border:"none",borderRadius:"3px",padding:"4px 10px",fontSize:"11px",cursor:d?"not-allowed":"pointer",transition:"all 0.2s",opacity:d?.7:1},children:"Positions"})]}),o.jsxs("select",{value:p,onChange:e=>M(e.target.value),disabled:d,style:{background:t.background,color:t.text,border:`1px solid ${t.border}`,borderRadius:"4px",padding:"5px 10px",fontSize:"11px",cursor:d?"not-allowed":"pointer",opacity:d?.7:1,outline:"none"},children:[o.jsx("option",{value:"6",children:"GCF"}),o.jsx("option",{value:"1",children:"GMF"}),o.jsx("option",{value:"all",children:"All Funds"})]}),o.jsx("button",{onClick:()=>W(!u),disabled:d,style:{background:t.primary,color:"white",border:"none",borderRadius:"4px",padding:"5px 12px",fontSize:"11px",cursor:d?"not-allowed":"pointer",transition:"all 0.2s",opacity:d?.7:1,minWidth:"80px"},children:u?"üìÇ Active":"üìÅ Closed"})]})]})}),!d&&!h&&(s==="trades"?f:S)&&o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"12px",padding:"16px",borderBottom:`1px solid ${t.border}`,backgroundColor:t.background},children:[s==="trades"&&f&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{backgroundColor:t.surface,padding:"12px",borderRadius:"6px",border:`1px solid ${t.border}`},children:[o.jsx("div",{style:{fontSize:"11px",color:t.textSecondary},children:"Total Notional"}),o.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:t.text},children:y(f.total_notional)})]}),o.jsxs("div",{style:{backgroundColor:t.surface,padding:"12px",borderRadius:"6px",border:`1px solid ${t.border}`},children:[o.jsx("div",{style:{fontSize:"11px",color:t.textSecondary},children:"Total P&L"}),o.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:f.total_pnl>=0?t.success:t.danger},children:y(f.total_pnl)})]}),o.jsxs("div",{style:{backgroundColor:t.surface,padding:"12px",borderRadius:"6px",border:`1px solid ${t.border}`},children:[o.jsx("div",{style:{fontSize:"11px",color:t.textSecondary},children:"Win Rate"}),o.jsxs("div",{style:{fontSize:"16px",fontWeight:"600",color:t.text},children:[f.total_trades>0?(f.profitable_trades/f.total_trades*100).toFixed(1):"0","%"]})]})]}),s==="positions"&&S&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{backgroundColor:t.surface,padding:"12px",borderRadius:"6px",border:`1px solid ${t.border}`},children:[o.jsx("div",{style:{fontSize:"11px",color:t.textSecondary},children:"Long Positions"}),o.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:t.success},children:S.long_positions})]}),o.jsxs("div",{style:{backgroundColor:t.surface,padding:"12px",borderRadius:"6px",border:`1px solid ${t.border}`},children:[o.jsx("div",{style:{fontSize:"11px",color:t.textSecondary},children:"Short Positions"}),o.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:t.danger},children:S.short_positions})]}),o.jsxs("div",{style:{backgroundColor:t.surface,padding:"12px",borderRadius:"6px",border:`1px solid ${t.border}`},children:[o.jsx("div",{style:{fontSize:"11px",color:t.textSecondary},children:"Total Volume"}),o.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:t.text},children:y(S.total_volume)})]})]})]}),o.jsxs("div",{style:{flex:1,overflow:"auto",padding:"16px"},children:[d&&o.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[o.jsx(T.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},style:{width:"40px",height:"40px",borderRadius:"50%",border:`3px solid ${t.border}`,borderTop:`3px solid ${t.primary}`,margin:"0 auto 16px"}}),o.jsxs("div",{style:{color:t.textSecondary,fontSize:"13px"},children:["Loading ",s,"..."]})]}),h&&!d&&o.jsx("div",{style:{background:t.background,border:`1px solid ${t.danger}`,borderRadius:"4px",padding:"12px",color:t.danger,marginBottom:"20px",fontSize:"13px"},children:h}),!d&&!h&&s==="trades"&&o.jsx("div",{style:{overflowX:"auto"},children:o.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[o.jsx("thead",{children:o.jsxs("tr",{style:{borderBottom:`2px solid ${t.border}`,backgroundColor:t.background},children:[o.jsx("th",{style:{padding:"8px",textAlign:"left",color:t.textSecondary},children:"Trade ID"}),o.jsx("th",{style:{padding:"8px",textAlign:"left",color:t.textSecondary},children:"Pair"}),o.jsx("th",{style:{padding:"8px",textAlign:"right",color:t.textSecondary},children:"Notional"}),o.jsx("th",{style:{padding:"8px",textAlign:"right",color:t.textSecondary},children:"Rate"}),o.jsx("th",{style:{padding:"8px",textAlign:"right",color:t.textSecondary},children:"Market"}),o.jsx("th",{style:{padding:"8px",textAlign:"right",color:t.textSecondary},children:"P&L"}),o.jsx("th",{style:{padding:"8px",textAlign:"left",color:t.textSecondary},children:"Counterparty"}),o.jsx("th",{style:{padding:"8px",textAlign:"left",color:t.textSecondary},children:"Status"})]})}),o.jsx("tbody",{children:c.map((e,g)=>o.jsxs(T.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:g*.02},style:{borderBottom:`1px solid ${t.border}`,"&:hover":{backgroundColor:t.background}},children:[o.jsx("td",{style:{padding:"8px",color:t.text},children:e.id}),o.jsx("td",{style:{padding:"8px",color:t.text,fontWeight:"500"},children:e.currency_pair}),o.jsx("td",{style:{padding:"8px",textAlign:"right",color:t.text},children:y(e.notional)}),o.jsx("td",{style:{padding:"8px",textAlign:"right",color:t.text},children:C(e.rate,e.currency_pair)}),o.jsx("td",{style:{padding:"8px",textAlign:"right",color:t.text},children:C(e.market_rate,e.currency_pair)}),o.jsx("td",{style:{padding:"8px",textAlign:"right",color:e.pnl>=0?t.success:t.danger,fontWeight:"500"},children:y(e.pnl)}),o.jsx("td",{style:{padding:"8px",color:t.text},children:e.counterparty}),o.jsx("td",{style:{padding:"8px"},children:o.jsx("span",{style:{color:k(e.status),fontSize:"10px",padding:"2px 6px",backgroundColor:`${k(e.status)}20`,borderRadius:"3px"},children:e.status})})]},e.id))})]})}),!d&&!h&&s==="positions"&&o.jsx("div",{style:{overflowX:"auto"},children:o.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[o.jsx("thead",{children:o.jsxs("tr",{style:{borderBottom:`2px solid ${t.border}`,backgroundColor:t.background},children:[o.jsx("th",{style:{padding:"8px",textAlign:"left",color:t.textSecondary},children:"Currency Pair"}),o.jsx("th",{style:{padding:"8px",textAlign:"right",color:t.textSecondary},children:"Net Position"}),o.jsx("th",{style:{padding:"8px",textAlign:"center",color:t.textSecondary},children:"Status"}),o.jsx("th",{style:{padding:"8px",textAlign:"right",color:t.textSecondary},children:"Trades"}),o.jsx("th",{style:{padding:"8px",textAlign:"right",color:t.textSecondary},children:"Avg Rate"}),o.jsx("th",{style:{padding:"8px",textAlign:"right",color:t.textSecondary},children:"Volume"}),o.jsx("th",{style:{padding:"8px",textAlign:"left",color:t.textSecondary},children:"Last Trade"})]})}),o.jsx("tbody",{children:A.map((e,g)=>o.jsxs(T.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:g*.02},style:{borderBottom:`1px solid ${t.border}`,"&:hover":{backgroundColor:t.background}},children:[o.jsx("td",{style:{padding:"8px",color:t.text,fontWeight:"500"},children:e.currency_pair}),o.jsx("td",{style:{padding:"8px",textAlign:"right",color:e.net_position>=0?t.success:t.danger,fontWeight:"500"},children:y(Math.abs(e.net_position))}),o.jsx("td",{style:{padding:"8px",textAlign:"center"},children:o.jsx("span",{style:{color:k(e.position_status),fontSize:"10px",padding:"2px 8px",backgroundColor:`${k(e.position_status)}20`,borderRadius:"3px"},children:e.position_status})}),o.jsx("td",{style:{padding:"8px",textAlign:"right",color:t.text},children:e.trade_count}),o.jsx("td",{style:{padding:"8px",textAlign:"right",color:t.text},children:C(e.weighted_avg_rate,e.currency_pair)}),o.jsx("td",{style:{padding:"8px",textAlign:"right",color:t.text},children:y(e.total_volume)}),o.jsx("td",{style:{padding:"8px",color:t.textSecondary,fontSize:"11px"},children:new Date(e.last_trade_date).toLocaleDateString()})]},e.currency_pair))})]})}),!d&&!h&&(s==="trades"&&c.length===0||s==="positions"&&A.length===0)&&o.jsxs("div",{style:{textAlign:"center",padding:"60px 20px",color:t.textSecondary},children:[o.jsx("div",{style:{fontSize:"48px",opacity:.3,marginBottom:"16px"},children:s==="trades"?"üìä":"üíπ"}),o.jsxs("div",{style:{fontSize:"14px"},children:["No ",s," found for the selected filters"]})]})]})]})},rt=l=>o.jsx(Y,{...l});export{rt as GZCPortfolioComponent};
