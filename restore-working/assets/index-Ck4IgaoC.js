import{j as e,A as B,m as E}from"./ui-vendor-k0rDQjvt.js";import{r as h}from"./react-vendor-C_4inHyB.js";import{u as A,b as Y,d as Q,e as H,a as G,f as X}from"./index-DG8D6RJe.js";function q({data:a,columns:g,onRowClick:o,onRowRightClick:t,onSort:s,selectedRows:d=[],onSelectRows:l,loading:n=!1,emptyMessage:x="No data available",height:i="auto",striped:b=!0,compact:m=!1,highlightOnHover:u=!0}){const{currentTheme:r}=A(),[f,j]=h.useState(null),[k,z]=h.useState("asc"),[v,M]=h.useState({}),I=h.useCallback(p=>{if(!p.sortable)return;const P=p.key,S=f===P&&k==="asc"?"desc":"asc";j(P),z(S),s&&s(p,S)},[f,k,s]),V=h.useMemo(()=>{let p=[...a];return Object.entries(v).forEach(([P,S])=>{S&&(p=p.filter(L=>String(L[P]||"").toLowerCase().includes(S.toLowerCase())))}),f&&!s&&p.sort((P,S)=>{const L=P[f],R=S[f];if(L===R)return 0;const c=L<R?-1:1;return k==="asc"?c:-c}),p},[a,v,f,k,s]),U=(p,P)=>{const S=String(P.key).split(".");let L=p;for(const R of S)L=L?.[R];return P.format?P.format(L,p):L},W=m?"8px 12px":"12px 16px";return e.jsxs("div",{style:{width:"100%",height:i,display:"flex",flexDirection:"column",backgroundColor:r.surface,borderRadius:"8px",border:`1px solid ${r.border}`,overflow:"hidden"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:g.map(p=>p.width||"1fr").join(" "),backgroundColor:r.background,borderBottom:`1px solid ${r.border}`,position:"sticky",top:0,zIndex:10},children:g.map(p=>e.jsxs("div",{onClick:()=>I(p),style:{padding:W,display:"flex",alignItems:"center",justifyContent:p.align||"left",gap:"8px",cursor:p.sortable?"pointer":"default",userSelect:"none",borderRight:`1px solid ${r.border}`,backgroundColor:r.background},className:p.headerClassName,children:[e.jsx("span",{style:{fontSize:m?"12px":"13px",fontWeight:"600",color:r.text},children:p.header}),p.sortable&&e.jsx("span",{style:{fontSize:"10px",color:f===String(p.key)?r.primary:r.textSecondary,opacity:f===String(p.key)?1:.3},children:f===String(p.key)&&k==="desc"?"▼":"▲"})]},String(p.key)))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:g.map(p=>p.width||"1fr").join(" "),backgroundColor:r.surface,borderBottom:`1px solid ${r.border}`},children:g.map(p=>e.jsx("div",{style:{padding:"4px 8px",borderRight:`1px solid ${r.border}`},children:p.filterable&&e.jsx("input",{type:"text",placeholder:`Filter ${p.header}`,value:v[String(p.key)]||"",onChange:P=>M({...v,[String(p.key)]:P.target.value}),style:{width:"100%",padding:"4px 8px",fontSize:"11px",backgroundColor:r.background,border:`1px solid ${r.border}`,borderRadius:"4px",color:r.text,outline:"none"}})},`filter-${String(p.key)}`))}),e.jsx("div",{style:{flex:1,overflow:"auto",position:"relative"},children:n?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"200px",color:r.textSecondary},children:e.jsx("div",{children:"Loading..."})}):V.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"200px",color:r.textSecondary,fontSize:"14px"},children:x}):e.jsx(B,{children:V.map((p,P)=>e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2,delay:P*.01},onClick:()=>o?.(p,P),onContextMenu:S=>{S.preventDefault(),t?.(p,P,S)},style:{display:"grid",gridTemplateColumns:g.map(S=>S.width||"1fr").join(" "),backgroundColor:d.includes(P)?`${r.primary}20`:b&&P%2===0?r.surface:r.background,borderBottom:`1px solid ${r.border}`,cursor:o?"pointer":"default",transition:"background-color 0.2s ease"},onMouseEnter:S=>{u&&!d.includes(P)&&(S.currentTarget.style.backgroundColor=`${r.primary}10`)},onMouseLeave:S=>{u&&!d.includes(P)&&(S.currentTarget.style.backgroundColor=b&&P%2===0?r.surface:r.background)},children:g.map(S=>e.jsx("div",{style:{padding:W,display:"flex",alignItems:"center",justifyContent:S.align||"left",borderRight:`1px solid ${r.border}`,fontSize:m?"12px":"13px",color:r.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},className:S.className,children:U(p,S)},`${P}-${String(S.key)}`))},P))})})]})}const Z=({items:a,position:g,isOpen:o,onClose:t})=>{const{currentTheme:s}=A(),d=h.useRef(null),[l,n]=h.useState(null),[x,i]=h.useState(g);h.useEffect(()=>{const u=r=>{d.current&&!d.current.contains(r.target)&&t()};return o&&(document.addEventListener("mousedown",u),document.addEventListener("contextmenu",u)),()=>{document.removeEventListener("mousedown",u),document.removeEventListener("contextmenu",u)}},[o,t]),h.useEffect(()=>{if(o&&d.current){const u=d.current.getBoundingClientRect(),{innerWidth:r,innerHeight:f}=window;let j=g.x,k=g.y;j+u.width>r&&(j=r-u.width-10),k+u.height>f&&(k=f-u.height-10),i({x:j,y:k})}},[o,g]);const b=u=>{u.disabled||u.submenu||(u.action&&u.action(),t())},m=(u,r)=>{if(u.divider)return e.jsx("div",{style:{height:"1px",backgroundColor:s.border,margin:"4px 0"}},r);const f=u.submenu&&u.submenu.length>0;return e.jsxs(E.div,{whileHover:{backgroundColor:u.disabled?"transparent":`${s.primary}10`},onClick:()=>b(u),onMouseEnter:()=>f&&n(r),onMouseLeave:()=>f&&n(null),style:{padding:"8px 16px",fontSize:"13px",color:u.disabled?s.textSecondary:u.danger?s.danger:s.text,cursor:u.disabled?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px",opacity:u.disabled?.5:1,position:"relative",userSelect:"none"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[u.icon&&e.jsx("span",{style:{fontSize:"14px",display:"flex",alignItems:"center"},children:u.icon}),e.jsx("span",{children:u.label})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{fontSize:"10px",opacity:.6},children:"▶"}),e.jsx(B,{children:l===r&&e.jsx(E.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.15},style:{position:"absolute",left:"100%",top:-8,marginLeft:"4px",minWidth:"180px",backgroundColor:s.surface,border:`1px solid ${s.border}`,borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",padding:"4px 0",zIndex:1001},children:u.submenu.map((j,k)=>m(j,`${r}-${k}`))})})]})]},r)};return e.jsx(B,{children:o&&e.jsx(E.div,{ref:d,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.15},style:{position:"fixed",left:x.x,top:x.y,minWidth:"200px",backgroundColor:s.surface,border:`1px solid ${s.border}`,borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",padding:"4px 0",zIndex:1e3},children:a.map((u,r)=>m(u,r))})})},J=({positions:a,onPositionClick:g,height:o=400})=>{const{currentTheme:t}=A(),[s,d]=h.useState({isOpen:!1,position:{x:0,y:0},data:null}),l=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(r),n=r=>`${r>=0?"+":""}${r.toFixed(2)}%`,x=r=>new Intl.NumberFormat("en-US",{minimumFractionDigits:0,maximumFractionDigits:4}).format(r),i=h.useMemo(()=>[{key:"symbol",header:"Symbol",width:120,sortable:!0,filterable:!0,format:(r,f)=>e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"600",color:t.text},children:r}),e.jsx("div",{style:{fontSize:"11px",color:t.textSecondary},children:f.assetClass})]})})},{key:"side",header:"Side",width:80,sortable:!0,filterable:!0,format:r=>e.jsx("span",{style:{padding:"2px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"500",backgroundColor:r==="LONG"?`${t.success}20`:`${t.danger}20`,color:r==="LONG"?t.success:t.danger},children:r})},{key:"quantity",header:"Quantity",width:120,sortable:!0,align:"right",format:r=>x(r)},{key:"averagePrice",header:"Avg Price",width:120,sortable:!0,align:"right",format:r=>l(r)},{key:"currentPrice",header:"Current Price",width:120,sortable:!0,align:"right",format:(r,f)=>e.jsx(E.div,{initial:{scale:1},animate:{scale:[1,1.05,1]},transition:{duration:.3},children:l(r)},r)},{key:"marketValue",header:"Market Value",width:140,sortable:!0,align:"right",format:r=>l(r)},{key:"unrealizedPnL",header:"Unrealized P&L",width:140,sortable:!0,align:"right",format:r=>e.jsx("span",{style:{color:r>=0?t.success:t.danger,fontWeight:"500"},children:l(r)})},{key:"totalPnL",header:"Total P&L",width:140,sortable:!0,align:"right",format:r=>e.jsx("span",{style:{color:r>=0?t.success:t.danger,fontWeight:"600"},children:l(r)})},{key:"pnlPercent",header:"P&L %",width:100,sortable:!0,align:"right",format:r=>e.jsx("span",{style:{color:r>=0?t.success:t.danger,fontWeight:"600"},children:n(r)})},{key:"weight",header:"Weight",width:100,sortable:!0,align:"right",format:r=>n(r)},{key:"lastUpdate",header:"Last Update",width:120,sortable:!0,format:r=>new Date(r).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}],[t]),b=[{label:"View Details",icon:"👁️",action:()=>{s.data&&console.log("View details for:",s.data.symbol)}},{label:"Trade",icon:"📈",submenu:[{label:"Buy More",icon:"🟢",action:()=>{s.data&&console.log("Buy more:",s.data.symbol)}},{label:"Sell Position",icon:"🔴",action:()=>{s.data&&console.log("Sell position:",s.data.symbol)}},{label:"Close Position",icon:"❌",danger:!0,action:()=>{s.data&&console.log("Close position:",s.data.symbol)}}]},{divider:!0},{label:"Set Alert",icon:"🔔",action:()=>{s.data&&console.log("Set alert for:",s.data.symbol)}},{label:"Add to Watchlist",icon:"⭐",action:()=>{s.data&&console.log("Add to watchlist:",s.data.symbol)}},{divider:!0},{label:"Export Data",icon:"📊",submenu:[{label:"Export to CSV",action:()=>console.log("Export to CSV")},{label:"Export to Excel",action:()=>console.log("Export to Excel")}]}],m=(r,f,j)=>{d({isOpen:!0,position:{x:j.clientX,y:j.clientY},data:r})},u=()=>{d({isOpen:!1,position:{x:0,y:0},data:null})};return e.jsxs(e.Fragment,{children:[e.jsx(q,{data:a,columns:i,onRowClick:g,onRowRightClick:m,height:o,loading:!1,emptyMessage:"No positions found",striped:!0,highlightOnHover:!0,compact:!1}),e.jsx(Z,{items:b,position:s.position,isOpen:s.isOpen,onClose:u})]})},K=({metrics:a,timeRange:g})=>{const{currentTheme:o}=A(),t=n=>n==null||isNaN(n)?"$0":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(n),s=n=>n==null||isNaN(n)?"0.00%":`${n>=0?"+":""}${n.toFixed(2)}%`,d=n=>n==null||isNaN(n)?"0.00":n.toFixed(2),l=[{label:"Total Value",value:t(a.totalValue),change:null,icon:"💰"},{label:"Market Value",value:t(a.marketValue),change:null,icon:"📊"},{label:"Day P&L",value:t(a.dayPnL),change:s(a.dayPnLPercent),changeColor:a.dayPnL>=0?o.success:o.danger,icon:"📈"},{label:"Total P&L",value:t(a.totalPnL),change:s(a.totalPnLPercent),changeColor:a.totalPnL>=0?o.success:o.danger,icon:"💹"},{label:"Realized P&L",value:t(a.realizedPnL),change:null,icon:"✅"},{label:"Unrealized P&L",value:t(a.unrealizedPnL),change:null,changeColor:a.unrealizedPnL>=0?o.success:o.danger,icon:"⏳"},{label:"Cash",value:t(a.cash),change:null,icon:"💵"},{label:"Leverage",value:`${d(a.leverage)}x`,change:null,icon:"⚖️"},{label:"Sharpe Ratio",value:d(a.sharpeRatio),change:null,icon:"📏"},{label:"Max Drawdown",value:s(a.maxDrawdown),change:null,changeColor:o.danger,icon:"📉"},{label:"Win Rate",value:s(a.winRate),change:null,icon:"🎯"},{label:"Beta",value:d(a.beta),change:null,icon:"📐"}];return e.jsxs("div",{style:{padding:"16px 20px",backgroundColor:o.surface,borderBottom:`1px solid ${o.border}`},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"20px",marginBottom:"16px"},children:l.slice(0,6).map((n,x)=>e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.05},style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px",backgroundColor:o.background,borderRadius:"8px",border:`1px solid ${o.border}`},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"16px"},children:n.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"11px",color:o.textSecondary,fontWeight:"500",textTransform:"uppercase",letterSpacing:"0.5px"},children:n.label}),e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:n.changeColor||o.text,marginTop:"2px"},children:n.value})]})]}),n.change&&e.jsx("div",{style:{fontSize:"12px",fontWeight:"500",color:n.changeColor,textAlign:"right"},children:n.change})]},n.label))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"12px"},children:l.slice(6).map((n,x)=>e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:(x+6)*.05},style:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 12px",backgroundColor:o.background,borderRadius:"6px",border:`1px solid ${o.border}`},children:[e.jsx("span",{style:{fontSize:"14px"},children:n.icon}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"10px",color:o.textSecondary,fontWeight:"500"},children:n.label}),e.jsx("div",{style:{fontSize:"13px",fontWeight:"600",color:n.changeColor||o.text},children:n.value})]})]},n.label))}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"12px",marginTop:"16px",paddingTop:"16px",borderTop:`1px solid ${o.border}`},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"10px",color:o.textSecondary,marginBottom:"4px"},children:"NET EXPOSURE"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:o.text},children:t(a.netExposure)})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"10px",color:o.textSecondary,marginBottom:"4px"},children:"GROSS EXPOSURE"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:o.text},children:t(a.grossExposure)})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"10px",color:o.textSecondary,marginBottom:"4px"},children:"LONG EXPOSURE"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:o.success},children:t(a.longExposure)})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"10px",color:o.textSecondary,marginBottom:"4px"},children:"SHORT EXPOSURE"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:o.danger},children:t(a.shortExposure)})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"10px",color:o.textSecondary,marginBottom:"4px"},children:"VOLATILITY"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:o.text},children:s(a.volatility)})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"10px",color:o.textSecondary,marginBottom:"4px"},children:"ALPHA"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:a.alpha>=0?o.success:o.danger},children:s(a.alpha)})]})]})]})},_=({positions:a,timeRange:g})=>{const{currentTheme:o}=A(),t=h.useMemo(()=>{const l=a.reduce((x,i)=>x+Math.abs(i.marketValue),0),n=a.reduce((x,i)=>{const b=Math.abs(i.marketValue);return x[i.assetClass]=(x[i.assetClass]||0)+b,x},{});return Object.entries(n).map(([x,i])=>({assetClass:x,value:i,percentage:i/l*100})).sort((x,i)=>i.value-x.value)},[a]),s=h.useMemo(()=>a.sort((l,n)=>Math.abs(n.totalPnL)-Math.abs(l.totalPnL)).slice(0,10),[a]),d=[o.primary,o.success,o.warning,o.info,o.secondary,"#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3"];return e.jsxs("div",{style:{padding:"20px",height:"100%",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[e.jsxs("div",{style:{backgroundColor:o.surface,borderRadius:"8px",border:`1px solid ${o.border}`,padding:"16px"},children:[e.jsx("h3",{style:{margin:"0 0 16px 0",fontSize:"16px",fontWeight:"600",color:o.text},children:"Asset Allocation"}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"300px"},children:e.jsx("svg",{width:"280",height:"280",viewBox:"0 0 280 280",children:t.map((l,n)=>{const x=l.percentage/100*360,i=t.slice(0,n).reduce((k,z)=>k+z.percentage/100*360,0),b=140+100*Math.cos((i-90)*Math.PI/180),m=140+100*Math.sin((i-90)*Math.PI/180),u=140+100*Math.cos((i+x-90)*Math.PI/180),r=140+100*Math.sin((i+x-90)*Math.PI/180),f=x>180?1:0,j=["M 140 140",`L ${b} ${m}`,`A 100 100 0 ${f} 1 ${u} ${r}`,"Z"].join(" ");return e.jsx("path",{d:j,fill:d[n%d.length],stroke:o.background,strokeWidth:"2"},l.assetClass)})})}),e.jsx("div",{style:{marginTop:"16px"},children:t.map((l,n)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:d[n%d.length]}}),e.jsx("span",{style:{fontSize:"12px",color:o.text},children:l.assetClass})]}),e.jsxs("div",{style:{fontSize:"12px",fontWeight:"500",color:o.text},children:[l.percentage.toFixed(1),"%"]})]},l.assetClass))})]}),e.jsxs("div",{style:{backgroundColor:o.surface,borderRadius:"8px",border:`1px solid ${o.border}`,padding:"16px"},children:[e.jsx("h3",{style:{margin:"0 0 16px 0",fontSize:"16px",fontWeight:"600",color:o.text},children:"Top P&L Contributors"}),e.jsx("div",{style:{height:"320px",display:"flex",flexDirection:"column",gap:"8px"},children:s.map((l,n)=>{const x=Math.max(...s.map(b=>Math.abs(b.totalPnL))),i=Math.abs(l.totalPnL)/x*100;return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",height:"28px"},children:[e.jsx("div",{style:{width:"60px",fontSize:"12px",fontWeight:"500",color:o.text,textAlign:"right"},children:l.symbol}),e.jsx("div",{style:{flex:1,height:"20px",backgroundColor:o.background,borderRadius:"4px",position:"relative",overflow:"hidden"},children:e.jsx("div",{style:{width:`${i}%`,height:"100%",backgroundColor:l.totalPnL>=0?o.success:o.danger,borderRadius:"4px",transition:"width 0.3s ease"}})}),e.jsxs("div",{style:{width:"80px",fontSize:"12px",fontWeight:"500",color:l.totalPnL>=0?o.success:o.danger,textAlign:"right"},children:[l.totalPnL>=0?"+":"","$",Math.abs(l.totalPnL).toFixed(0)]})]},l.symbol)})})]})]})},N=[{symbol:"AAPL",assetClass:"EQUITY",currency:"USD"},{symbol:"TSLA",assetClass:"EQUITY",currency:"USD"},{symbol:"MSFT",assetClass:"EQUITY",currency:"USD"},{symbol:"GOOGL",assetClass:"EQUITY",currency:"USD"},{symbol:"AMZN",assetClass:"EQUITY",currency:"USD"},{symbol:"NVDA",assetClass:"EQUITY",currency:"USD"},{symbol:"META",assetClass:"EQUITY",currency:"USD"},{symbol:"NFLX",assetClass:"EQUITY",currency:"USD"},{symbol:"EURUSD",assetClass:"FX",currency:"USD"},{symbol:"GBPUSD",assetClass:"FX",currency:"USD"},{symbol:"USDJPY",assetClass:"FX",currency:"USD"},{symbol:"GOLD",assetClass:"COMMODITY",currency:"USD"},{symbol:"SILVER",assetClass:"COMMODITY",currency:"USD"},{symbol:"OIL",assetClass:"COMMODITY",currency:"USD"},{symbol:"BTC",assetClass:"CRYPTO",currency:"USD"},{symbol:"ETH",assetClass:"CRYPTO",currency:"USD"},{symbol:"US10Y",assetClass:"BOND",currency:"USD"},{symbol:"US30Y",assetClass:"BOND",currency:"USD"},{symbol:"SPY",assetClass:"EQUITY",currency:"USD"},{symbol:"QQQ",assetClass:"EQUITY",currency:"USD"}];function ee(a){const g=N[Math.floor(Math.random()*N.length)],o=Math.random()>.7?"SHORT":"LONG",t=Math.floor(Math.random()*1e4)+100,s=Math.random()*500+50,d=(Math.random()-.5)*.1,l=s*(1+d),n=t*l*(o==="SHORT"?-1:1),x=t*s,i=(l-s)*t*(o==="SHORT"?-1:1),b=(Math.random()-.5)*5e3,m=i+b,u=m/Math.abs(x)*100;return{symbol:g.symbol,quantity:o==="SHORT"?-t:t,averagePrice:s,currentPrice:l,marketValue:n,unrealizedPnL:i,realizedPnL:b,totalPnL:m,pnlPercent:u,weight:0,side:o,assetClass:g.assetClass,currency:g.currency,lastUpdate:new Date().toISOString()}}function te(a){const g=a.reduce((v,M)=>v+Math.abs(M.marketValue),0),o=a.reduce((v,M)=>v+M.unrealizedPnL,0),t=a.reduce((v,M)=>v+M.realizedPnL,0),s=o+t,d=a.filter(v=>v.side==="LONG").reduce((v,M)=>v+M.marketValue,0),l=Math.abs(a.filter(v=>v.side==="SHORT").reduce((v,M)=>v+M.marketValue,0)),n=1e5+t,x=n+g,i=d-l,b=d+l,m=b/x,u=1.2+Math.random()*.8,r=.15+Math.random()*.1,f=.8+Math.random()*.4,j=(Math.random()-.5)*.1,k=-.05-Math.random()*.1,z=.55+Math.random()*.2;return{totalValue:x,cash:n,marketValue:g,dayPnL:s*.3,dayPnLPercent:s*.3/x*100,totalPnL:s,totalPnLPercent:s/x*100,realizedPnL:t,unrealizedPnL:o,netExposure:i,grossExposure:b,longExposure:d,shortExposure:l,leverage:m,sharpeRatio:u,volatility:r*100,beta:f,alpha:j*100,maxDrawdown:k*100,winRate:z*100}}function re(a,g){return a.map(o=>({...o,weight:Math.abs(o.marketValue)/g*100}))}function oe(a){const g=8+Math.floor(Math.random()*12),o=Array.from({length:g},()=>ee()),t=te(o),s=re(o,t.totalValue);return{timestamp:new Date().toISOString(),positions:s,metrics:t,risk:{var95:-45e3,var99:-67e3,cvar95:-52e3,cvar99:-78e3,stressTest:[{scenario:"Market Crash (-20%)",impact:-89e3,impactPercent:-8.9},{scenario:"Interest Rate Spike",impact:-34e3,impactPercent:-3.4},{scenario:"Currency Crisis",impact:-23e3,impactPercent:-2.3}]},attribution:{byAssetClass:{EQUITY:45.2,FX:23.1,COMMODITY:15.7,CRYPTO:10.3,BOND:5.7},bySector:{Technology:35.2,Financial:20.1,Energy:15.7,Healthcare:12.3,Consumer:16.7},byPosition:o.reduce((d,l)=>(d[l.symbol]=l.weight,d),{}),byFactor:{market:68.5,sector:15.2,stock:12.8,currency:2.1,other:1.4}}}}const ae=a=>{const[g,o]=h.useState([]),[t,s]=h.useState(!1),[d,l]=h.useState(null),{currentDate:n}=Y();return h.useEffect(()=>{(async()=>{try{s(!0),console.log("[PortfolioData] Making authenticated request...");const i=new URLSearchParams;a?.symbol&&i.append("symbol",a.symbol),a?.fundId&&i.append("fundId",a.fundId.toString()),a?.trader&&i.append("trader",a.trader),a?.position&&i.append("position",a.position),n&&i.append("currentDate",n.toISOString().split("T")[0]),console.log("[PortfolioData] Filters:",a);const b=`/portfolio?${i.toString()}`;console.log("[PortfolioData] Fetching:",b);const m=await Q.get(b);console.log("[PortfolioData] Response:",m),m?.data?o(m.data.data):o([]),l(null)}catch(i){i instanceof Error?(console.error("[PortfolioData] Error:",i.message),l(i.message)):(console.error("[PortfolioData] Unknown error:",i),l("Unexpected error"))}finally{s(!1)}})()},[a?.symbol,a?.fundId,a?.trader,a?.position,n]),{portfolio:g,isLoading:t,error:d}},ne=()=>{const[a,g]=h.useState([]),[o,t]=h.useState(!1),[s,d]=h.useState(null),{currentDate:l}=Y();return h.useEffect(()=>{const n=async()=>{try{t(!0),console.log("[TransactionsData] Making authenticated request...");const i=new URLSearchParams;l&&i.append("currentDate",l.toISOString().split("T")[0]);const b=`/transactions/unmatched?${i.toString()}`;console.log("[TransactionsData] Fetching:",b);const m=await Q.get(b);console.log("[TransactionsData] Response:",m),m?.data?g(m.data.data):g([]),d(null)}catch(i){i instanceof Error?(console.error("[TransactionsData] Error:",i.message),d(i.message)):(console.error("[TransactionsData] Unknown error:",i),d("Unexpected error"))}finally{t(!1)}};n();const x=setInterval(n,5*60*1e3);return()=>clearInterval(x)},[l]),{transactions:a,isLoading:o,error:s}},ce=({width:a="100%",height:g="100%",mockMode:o=!1})=>{const{currentTheme:t}=A(),{user:s}=H(),{isAuthenticated:d}=G(),{subscribeToSymbol:l,unsubscribeFromSymbol:n,getQuote:x}=X(),[i,b]=h.useState([]),[m,u]=h.useState(null),[r,f]=h.useState({search:"",side:"ALL",profitable:void 0}),[j,k]=h.useState("1D"),[z,v]=h.useState("table"),M=h.useMemo(()=>({symbol:r.search,fundId:void 0,trader:"",position:""}),[r.search]),{portfolio:I,isLoading:V,error:U}=ae(d&&!o?M:void 0),{isLoading:W,error:p}=ne(),P=o?!1:V||W;h.useEffect(()=>{(async()=>{if(o){const C=oe(s?.id||"default");b(C.positions),u(C.metrics),C.positions.forEach(D=>{l(D.symbol)})}else if(I&&d){console.log("[Portfolio] Processing real portfolio data:",I);const C=I.map(y=>({id:y.id||`${y.symbol}-${Date.now()}`,symbol:y.symbol,side:y.position>0?"BUY":"SELL",quantity:Math.abs(y.position),averagePrice:y.avgPrice||0,currentPrice:y.currentPrice||y.avgPrice||0,marketValue:Math.abs(y.position)*(y.currentPrice||y.avgPrice||0),costBasis:Math.abs(y.position)*(y.avgPrice||0),unrealizedPnL:y.unrealizedPnL||0,realizedPnL:y.realizedPnL||0,totalPnL:(y.unrealizedPnL||0)+(y.realizedPnL||0),pnlPercent:y.avgPrice?(y.unrealizedPnL||0)/(Math.abs(y.position)*y.avgPrice)*100:0,assetClass:y.assetClass||"FX",sector:y.sector||"Currency",lastUpdate:new Date().toISOString(),openDate:y.createdAt||new Date().toISOString()}));b(C);const D=C.reduce((y,O)=>y+Math.abs(O.marketValue),0),w=C.reduce((y,O)=>y+O.unrealizedPnL,0),T=C.reduce((y,O)=>y+O.realizedPnL,0),$=w+T,F={totalValue:D,marketValue:D,cash:0,dayPnL:w,dayPnLPercent:D>0?w/D*100:0,totalPnL:$,totalPnLPercent:D>0?$/D*100:0,unrealizedPnL:w,realizedPnL:T,leverage:1,marginUsed:0,marginAvailable:0};u(F),C.forEach(y=>{l(y.symbol)}),console.log("[Portfolio] Transformed positions:",C),console.log("[Portfolio] Calculated metrics:",F)}})()},[s,o,I,d,l,n]),h.useEffect(()=>{U&&console.error("[Portfolio] Portfolio data error:",U),p&&console.error("[Portfolio] Transactions data error:",p)},[U,p]);const S=h.useMemo(()=>i.map(c=>{const C=x(c.symbol);if(!C)return c;const D=C.last,w=c.quantity*D,T=c.quantity*c.averagePrice,$=w-T,F=$/T*100;return{...c,currentPrice:D,marketValue:w,unrealizedPnL:$,totalPnL:c.realizedPnL+$,pnlPercent:F}}),[i,x]),L=h.useMemo(()=>S.filter(c=>{if(r.search){const C=r.search.toLowerCase();if(!c.symbol.toLowerCase().includes(C))return!1}if(r.side!=="ALL"&&c.side!==r.side)return!1;if(r.profitable!==void 0){const C=c.totalPnL>0;if(r.profitable!==C)return!1}return!(r.assetClass&&r.assetClass.length>0&&!r.assetClass.includes(c.assetClass))}),[S,r]),R=h.useMemo(()=>{if(!m)return null;const c=L.reduce((w,T)=>w+T.marketValue,0),C=L.reduce((w,T)=>w+T.unrealizedPnL,0),D=L.reduce((w,T)=>w+T.totalPnL,0);return{...m,marketValue:c,unrealizedPnL:C,totalPnL:D,totalPnLPercent:D/(c-D)*100}},[m,L]);return e.jsxs("div",{style:{width:a,height:g,display:"flex",flexDirection:"column",backgroundColor:t.background,borderRadius:"8px",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"16px 20px",borderBottom:`1px solid ${t.border}`,backgroundColor:t.surface},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"18px",fontWeight:"600",color:t.text},children:"Portfolio"}),e.jsx("div",{style:{padding:"4px 8px",backgroundColor:o?t.warning+"20":t.success+"20",color:o?t.warning:t.success,borderRadius:"4px",fontSize:"11px",fontWeight:"500",border:`1px solid ${o?t.warning:t.success}40`},children:o?"🔧 Mock Data":"📡 Live Data"}),!o&&e.jsx("div",{style:{padding:"4px 8px",backgroundColor:d?t.success+"20":t.danger+"20",color:d?t.success:t.danger,borderRadius:"4px",fontSize:"11px",fontWeight:"500",border:`1px solid ${d?t.success:t.danger}40`},children:d?"✅ Authenticated":"❌ Not Authenticated"}),(U||p)&&e.jsx("div",{style:{padding:"4px 8px",backgroundColor:t.danger+"20",color:t.danger,borderRadius:"4px",fontSize:"11px",fontWeight:"500",border:`1px solid ${t.danger}40`,cursor:"pointer"},title:U||p||void 0,children:"⚠️ API Error"})]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>{window.location.search=o?"?mode=real":"?mode=mock"},style:{padding:"6px 12px",backgroundColor:t.primary,color:"white",border:"none",borderRadius:"4px",fontSize:"12px",cursor:"pointer"},children:["Switch to ",o?"Real":"Mock"," Data"]}),e.jsx("div",{style:{display:"flex",backgroundColor:t.background,borderRadius:"6px",padding:"2px",border:`1px solid ${t.border}`},children:["table","grid","chart"].map(c=>e.jsx("button",{onClick:()=>v(c),style:{padding:"6px 12px",backgroundColor:z===c?t.primary:"transparent",color:z===c?t.background:t.text,border:"none",borderRadius:"4px",fontSize:"12px",cursor:"pointer",textTransform:"capitalize",transition:"all 0.2s ease"},children:c},c))}),e.jsx("select",{value:j,onChange:c=>k(c.target.value),style:{padding:"6px 12px",backgroundColor:t.background,color:t.text,border:`1px solid ${t.border}`,borderRadius:"6px",fontSize:"12px",cursor:"pointer"},children:["1D","1W","1M","3M","6M","YTD","1Y","ALL"].map(c=>e.jsx("option",{value:c,children:c},c))})]})]})}),R&&e.jsx(K,{metrics:R,timeRange:j}),e.jsx("div",{style:{padding:"12px 20px",borderBottom:`1px solid ${t.border}`,backgroundColor:t.surface},children:e.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"center"},children:[e.jsx("input",{type:"text",placeholder:"Search symbols...",value:r.search,onChange:c=>f({...r,search:c.target.value}),style:{flex:1,maxWidth:"300px",padding:"6px 12px",backgroundColor:t.background,color:t.text,border:`1px solid ${t.border}`,borderRadius:"6px",fontSize:"13px",outline:"none"}}),e.jsxs("select",{value:r.side,onChange:c=>f({...r,side:c.target.value}),style:{padding:"6px 12px",backgroundColor:t.background,color:t.text,border:`1px solid ${t.border}`,borderRadius:"6px",fontSize:"13px",cursor:"pointer"},children:[e.jsx("option",{value:"ALL",children:"All Positions"}),e.jsx("option",{value:"LONG",children:"Long Only"}),e.jsx("option",{value:"SHORT",children:"Short Only"})]}),e.jsx("button",{onClick:()=>f({...r,profitable:r.profitable===!0?!1:r.profitable===!1?void 0:!0}),style:{padding:"6px 12px",backgroundColor:r.profitable===!0?t.success:r.profitable===!1?t.danger:t.background,color:r.profitable!==void 0?t.background:t.text,border:`1px solid ${r.profitable!==void 0?"transparent":t.border}`,borderRadius:"6px",fontSize:"13px",cursor:"pointer"},children:r.profitable===!0?"✓ Profitable":r.profitable===!1?"✗ Losing":"All P&L"}),e.jsx("div",{style:{flex:1}}),e.jsxs("span",{style:{fontSize:"12px",color:t.textSecondary},children:[L.length," positions"]})]})}),e.jsx("div",{style:{flex:1,overflow:"hidden",padding:"0"},children:P?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:t.textSecondary},children:"Loading portfolio..."}):z==="table"?e.jsx(J,{positions:L,onPositionClick:c=>console.log("Position clicked:",c)}):z==="chart"?e.jsx(_,{positions:L,timeRange:j}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"16px",padding:"16px"},children:L.map(c=>e.jsxs(E.div,{whileHover:{scale:1.02},style:{padding:"16px",backgroundColor:t.surface,borderRadius:"8px",border:`1px solid ${t.border}`,cursor:"pointer"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"12px"},children:[e.jsxs("div",{children:[e.jsx("h4",{style:{margin:0,color:t.text},children:c.symbol}),e.jsxs("span",{style:{fontSize:"12px",color:t.textSecondary},children:[c.side," •"," ",c.assetClass]})]}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:"600",color:c.totalPnL>=0?t.success:t.danger},children:[c.totalPnL>=0?"+":"",c.pnlPercent.toFixed(2),"%"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"13px"},children:[e.jsx("span",{style:{color:t.textSecondary},children:"Value"}),e.jsxs("span",{style:{color:t.text},children:["$",c.marketValue.toLocaleString("en-US",{minimumFractionDigits:2})]})]})]},c.symbol))})})]})};export{ce as Portfolio,_ as PortfolioChart,K as PortfolioMetrics,J as PortfolioTable};
